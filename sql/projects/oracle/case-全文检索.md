# Oracle 实战案例：全文检索

## 1. 需求描述
以"文章内容搜索"为例，要求支持对大量文本内容进行高效关键词检索、相关性排序，适合内容管理、商品搜索、日志分析等场景。

## 2. 表结构设计
```sql
CREATE TABLE articles (
  id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  title VARCHAR2(255) NOT NULL,
  content CLOB NOT NULL,
  created_at DATE DEFAULT SYSDATE
);

-- 创建 Oracle Text 全文索引
CREATE INDEX idx_articles_content_fts ON articles(content) INDEXTYPE IS CTXSYS.CONTEXT;
```

## 3. 核心 SQL 示例
```sql
-- 基于 CONTAINS 的全文检索
SELECT id, title, SCORE(1) AS rank
FROM articles
WHERE CONTAINS(content, :keywords, 1) > 0
ORDER BY rank DESC
FETCH FIRST 10 ROWS ONLY;

-- 维护索引（重建）
ALTER INDEX idx_articles_content_fts REBUILD;
```

## 4. Node.js 代码示例（含 JSDoc 注释）
```js
/**
 * 全文检索文章内容
 * @param {oracledb.Connection} conn
 * @param {string} keywords - 检索关键词
 * @param {number} [limit=10]
 * @returns {Promise<Array<{ID:number,TITLE:string,RANK:number}>>}
 */
async function searchArticles(conn, keywords, limit = 10) {
  const sql = `
    SELECT id, title, SCORE(1) AS rank
    FROM articles
    WHERE CONTAINS(content, :keywords, 1) > 0
    ORDER BY rank DESC
    FETCH FIRST :limit ROWS ONLY
  `;
  const result = await conn.execute(sql, { keywords, limit });
  return result.rows;
}
```

## 5. 优化与总结
- 推荐使用 Oracle Text（CONTEXT 索引）提升全文检索性能
- 查询时优先用 CONTAINS，避免 LIKE 全表扫描
- 可结合 title 字段做联合检索与权重排序
- 定期维护索引，保证检索效率
- 注意 CLOB 字段需用专用索引，检索语法与普通 SQL 有差异

---

本案例适合内容管理、商品搜索、日志分析等场景，建议结合实际业务调整分词与索引策略。 