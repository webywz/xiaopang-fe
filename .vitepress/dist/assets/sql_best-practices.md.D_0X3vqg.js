import{_ as i,c as a,o as n,ag as l}from"./chunks/framework.DPDPlp3K.js";const o=JSON.parse('{"title":"SQL 团队开发规范与数据安全","description":"","frontmatter":{},"headers":[],"relativePath":"sql/best-practices.md","filePath":"sql/best-practices.md","lastUpdated":1747206212000}'),h={name:"sql/best-practices.md"};function p(e,s,t,k,r,d){return n(),a("div",null,s[0]||(s[0]=[l(`<h1 id="sql-团队开发规范与数据安全" tabindex="-1">SQL 团队开发规范与数据安全 <a class="header-anchor" href="#sql-团队开发规范与数据安全" aria-label="Permalink to &quot;SQL 团队开发规范与数据安全&quot;">​</a></h1><h2 id="_1-命名规范与表结构设计" tabindex="-1">1. 命名规范与表结构设计 <a class="header-anchor" href="#_1-命名规范与表结构设计" aria-label="Permalink to &quot;1. 命名规范与表结构设计&quot;">​</a></h2><ul><li>表名、字段名统一小写、下划线分隔，避免缩写与保留字</li><li>主键建议用自增ID或UUID，外键命名为 xxx_id</li><li>字段类型选择需兼顾存储与性能，避免过度冗余</li><li>重要字段加唯一索引，提升约束与查询效率</li><li>表结构变更需评估影响，建议版本化管理</li></ul><h2 id="_2-代码规范与团队协作" tabindex="-1">2. 代码规范与团队协作 <a class="header-anchor" href="#_2-代码规范与团队协作" aria-label="Permalink to &quot;2. 代码规范与团队协作&quot;">​</a></h2><ul><li>所有 SQL 语句、脚本、迁移文件需版本控制（如 Git）</li><li>复杂 SQL 建议注释说明业务意图</li><li>统一使用参数化查询，严禁拼接 SQL</li><li>代码评审需包含 SQL 审查环节</li><li>团队定期分享最佳实践与踩坑案例</li></ul><h2 id="_3-权限管理与安全控制" tabindex="-1">3. 权限管理与安全控制 <a class="header-anchor" href="#_3-权限管理与安全控制" aria-label="Permalink to &quot;3. 权限管理与安全控制&quot;">​</a></h2><ul><li>生产、测试、开发环境分离，权限最小化</li><li>只授予必要的表/视图/函数权限，禁用高危操作</li><li>定期审计数据库账户与权限变更</li><li>重要操作建议二次确认与日志记录</li></ul><h2 id="_4-数据脱敏与隐私保护" tabindex="-1">4. 数据脱敏与隐私保护 <a class="header-anchor" href="#_4-数据脱敏与隐私保护" aria-label="Permalink to &quot;4. 数据脱敏与隐私保护&quot;">​</a></h2><ul><li>敏感字段（如手机号、身份证、邮箱）存储前加密或脱敏</li><li>查询接口返回前做数据脱敏处理</li><li>备份文件加密存储，防止泄露</li><li>遵循相关法律法规（如GDPR、网络安全法）</li></ul><h2 id="_5-备份策略与容灾" tabindex="-1">5. 备份策略与容灾 <a class="header-anchor" href="#_5-备份策略与容灾" aria-label="Permalink to &quot;5. 备份策略与容灾&quot;">​</a></h2><ul><li>生产环境定期全量+增量备份，异地/云端存储</li><li>定期测试恢复流程，确保备份可用</li><li>关键业务建议多地多活、主备切换</li></ul><h2 id="_6-变更管理与上线流程" tabindex="-1">6. 变更管理与上线流程 <a class="header-anchor" href="#_6-变更管理与上线流程" aria-label="Permalink to &quot;6. 变更管理与上线流程&quot;">​</a></h2><ul><li>表结构/索引/权限变更需走评审与灰度流程</li><li>生产变更建议业务低峰期执行，做好回滚预案</li><li>变更前后监控性能与数据一致性</li></ul><h2 id="_7-典型代码片段-含-jsdoc-注释" tabindex="-1">7. 典型代码片段（含 JSDoc 注释） <a class="header-anchor" href="#_7-典型代码片段-含-jsdoc-注释" aria-label="Permalink to &quot;7. 典型代码片段（含 JSDoc 注释）&quot;">​</a></h2><div class="language-js vp-adaptive-theme line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 查询并脱敏手机号</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {import(&#39;pg&#39;).Pool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pool</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {Promise&lt;Array&lt;{id:number,phone:string}&gt;&gt;}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> getMaskedPhones</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sql</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;SELECT id, regexp_replace(phone, &#39;(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{3})</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{4}(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">d{4})&#39;, &#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1****</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\\\</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">2&#39;) AS phone FROM users&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">rows</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pool.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(sql);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> rows;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">/**</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * 仅授予只读权限</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {import(&#39;pg&#39;).Pool}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pool</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@param</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {string}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> user</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> * </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">@returns</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> {Promise&lt;void&gt;}</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> */</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grantReadOnly</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">pool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">user</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pool.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">query</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`GRANT SELECT ON ALL TABLES IN SCHEMA public TO \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="_8-团队协作与知识共享建议" tabindex="-1">8. 团队协作与知识共享建议 <a class="header-anchor" href="#_8-团队协作与知识共享建议" aria-label="Permalink to &quot;8. 团队协作与知识共享建议&quot;">​</a></h2><ul><li>建立团队 SQL 规范文档，定期更新</li><li>组织技术分享、代码走查，沉淀最佳实践</li><li>复盘线上事故，持续改进流程与规范</li></ul><hr><p>规范与安全是高质量数据开发的基石，建议团队持续学习、协作与总结。</p>`,19)]))}const E=i(h,[["render",p]]);export{o as __pageData,E as default};
